#!/bin/bash
# JustFit E2E 测试指导脚本

echo "================================"
echo "  JustFit E2E 测试指导"
echo "================================"
echo ""

cat << 'EOF'
本脚本提供 E2E 测试的执行指导。

前置条件:
  1. 应用已成功编译
  2. 有可访问的 vCenter 或 H3C UIS 环境
  3. 浏览器开发者工具可用

测试步骤:
================================

【测试 1】创建连接
--------------------------------
1. 启动应用: wails dev
2. 打开应用窗口
3. 进入"连接管理"页面
4. 点击"新建连接"
5. 填写连接信息:
   - 名称: E2E Test Connection
   - 平台: 选择你的平台类型
   - 主机: 输入平台地址
   - 端口: 443
   - 用户名: 输入用户名
   - 密码: 输入密码
6. 点击"测试连接"
7. 验证显示"连接成功"
8. 点击"保存"

预期结果:
  ✓ 连接列表中出现新连接
  ✓ 状态显示为"已连接"

【测试 2】数据采集
--------------------------------
1. 进入"数据采集"页面
2. 选择刚创建的连接
3. 选中所有数据类型:
   ☑ 集群
   ☑ 主机
   ☑ 虚拟机
   ☑ 性能指标
4. 设置采集天数为: 7
5. 点击"开始采集"
6. 观察任务进度

预期结果:
  ✓ 任务创建成功
  ✓ 进度从 0% 逐步增加到 100%
  ✓ 任务状态变为"已完成"
  ✓ 显示统计数据

【测试 3】僵尸 VM 分析
--------------------------------
1. 进入"分析结果" -> "僵尸 VM"页面
2. 选择要分析的连接
3. 配置参数:
   - 分析天数: 30
   - CPU 阈值: 5%
   - 内存阈值: 10%
   - 最小置信度: 80%
4. 点击"开始分析"
5. 等待分析完成

预期结果:
  ✓ 分析任务创建成功
  ✓ 显示分析结果列表
  ✓ 每个结果包含 VM 名称、置信度
  ✓ 可以查看详细证据

【测试 4】Right Size 分析
--------------------------------
1. 进入"分析结果" -> "Right Size"页面
2. 选择要分析的连接
3. 配置参数:
   - 分析天数: 30
   - 缓冲比例: 1.2
   - 百分位数: 95
4. 点击"开始分析"
5. 查看分析结果

预期结果:
  ✓ 显示 VM 调整建议
  ✓ 标注调整类型 (上调/下调/无需调整)
  ✓ 显示风险等级

【测试 5】潮汐模式检测
--------------------------------
1. 进入"分析结果" -> "潮汐检测"页面
2. 选择要分析的连接
3. 配置参数:
   - 分析天数: 14
   - 最小稳定性: 70%
4. 点击"开始分析"
5. 查看分析结果

预期结果:
  ✓ 显示潮汐模式 (日潮汐/周潮汐/无模式)
  ✓ 显示峰值时段

【测试 6】健康评分
--------------------------------
1. 进入"分析结果" -> "平台健康"页面
2. 选择要分析的连接
3. 点击"开始分析"
4. 查看评分结果

预期结果:
  ✓ 显示总体健康评分
  ✓ 显示资源均衡度
  ✓ 显示超配风险

【测试 7】导出报告
--------------------------------
1. 进入"任务中心"页面
2. 选择一个已完成的分析任务
3. 点击"导出报告"
4. 选择导出格式: JSON
5. 等待导出完成

预期结果:
  ✓ 显示导出进度
  ✓ 导出完成后显示文件路径
  ✓ 文件可以打开查看

================================

浏览器控制台测试脚本:
--------------------------------
打开浏览器开发者工具(F12)，在Console中执行:

// 1. 创建连接
window.api.CreateConnection({
  name: "E2E Test",
  platform: "vcenter",
  host: "192.168.1.100",
  port: 443,
  username: "admin",
  password: "password",
  insecure: true
}).then(r => console.log("连接ID:", r.data.id));

// 2. 查询连接列表
window.api.ListConnections().then(r => console.log("连接列表:", r.data));

// 3. 查询 VM 列表
window.api.ListVMs({connection_id: 1}).then(r => console.log("VM列表:", r.data));

================================

测试反馈:
--------------------------------
测试完成后，请记录:
  1. 成功的测试用例数量
  2. 失败的测试用例及错误信息
  3. 发现的 Bug 或异常
  4. 性能问题（如卡顿、延迟）

将结果反馈给开发人员。

EOF

echo ""
echo "================================"
echo "按回车键开始 E2E 测试..."
read -r

echo "正在启动应用..."
echo "请在新终端中执行: wails dev"
echo ""
echo "然后按照上述步骤手动测试。"
echo ""
