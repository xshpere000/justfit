# JustFit 用户故事与验收标准

## 0. 文档信息

| 项目 | 内容 |
|------|------|
| 文档名称 | 用户故事与验收标准 |
| 版本 | v1.0 |
| 日期 | 2026-02-07 |
| 项目版本 | v0.0.1 Beta |

## 1. 用户故事概览

| ID | 用户故事 | 角色 | 优先级 |
|----|----------|------|--------|
| US-001 | 连接并采集 vCenter 数据 | 资源管理员 | P0 |
| US-002 | 查看数据采集状态 | 资源管理员 | P0 |
| US-003 | 查看平台健康总览 | 资源管理员 | P1 |
| US-004 | 识别僵尸虚拟机 | 运维工程师 | P1 |
| US-005 | 获取资源配置建议 | 运维工程师 | P1 |
| US-006 | 识别潮汐性工作负载 | 运维工程师 | P2 |
| US-007 | 查看平台健康详情 | 资源管理员 | P2 |
| US-008 | 生成并导出分析报告 | 管理者 | P1 |
| US-009 | 管理系统配置 | 资源管理员 | P2 |

---

## 2. 用户故事详情

### US-001: 连接并采集 vCenter 数据

**作为** 资源管理员
**我想要** 连接到我的 vCenter 并采集虚拟化资源数据
**以便** 后续进行资源分析与优化

#### 2.1 验收标准

**Gherkin 格式：**

```gherkin
Feature: 连接并采集 vCenter 数据

  Scenario: 成功创建 vCenter 连接
    Given 用户在"连接与采集"页面
    When 用户点击"新增连接"按钮
    And 用户选择平台类型为"VMware vCenter"
    And 用户填写有效的 vCenter 地址
    And 用户填写有效的用户名和密码
    And 用户点击"测试连接"
    Then 系统显示"连接成功"提示
    And 用户点击"保存"
    Then 连接被添加到连接列表

  Scenario: 采集任务执行成功
    Given 已有可用的 vCenter 连接
    When 用户选择该连接
    And 用户配置采集范围（集群/主机/VM）
    And 用户配置采集时间窗口
    And 用户点击"开始采集"
    Then 采集任务被创建并开始执行
    And 任务状态实时更新
    And 采集完成后数据存入 SQLite 数据库

  Scenario: 连接失败处理
    Given 用户在"新增连接"对话框
    When 用户填写无效的 vCenter 地址
    And 用户点击"测试连接"
    Then 系统显示"连接失败"错误提示
    And 提示包含失败原因
```

#### 2.2 验收测试清单

- [ ] 支持新增 vCenter 连接
- [ ] 支持编辑已有连接配置
- [ ] 支持删除连接（需二次确认）
- [ ] 连接测试功能正常
- [ ] 采集任务配置界面完整
- [ ] 采集进度实时显示
- [ ] 采集失败有明确错误提示

---

### US-002: 查看数据采集状态

**作为** 资源管理员
**我想要** 查看数据采集任务的执行状态和结果
**以便** 了解数据采集进展并处理异常情况

#### 2.1 验收标准

```gherkin
Feature: 查看数据采集状态

  Scenario: 查看任务列表
    Given 用户在"任务中心"页面
    When 用户打开任务列表
    Then 显示所有采集任务
    And 每个任务显示：任务名称、状态、开始时间、耗时

  Scenario: 查看任务详情
    Given 用户在任务列表
    When 用户点击某个任务
    Then 显示任务详情
    And 包含：采集范围、进度、日志输出

  Scenario: 处理失败任务
    Given 有一个失败的采集任务
    When 用户查看该任务详情
    Then 显示失败原因和错误日志
    And 提供"重试"按钮
    When 用户点击"重试"
    Then 任务重新执行
```

#### 2.2 验收测试清单

- [ ] 任务列表展示完整信息
- [ ] 任务状态实时更新
- [ ] 支持任务筛选和排序
- [ ] 支持查看任务日志
- [ ] 失败任务可重试
- [ ] 运行中任务可停止

---

### US-003: 查看平台健康总览

**作为** 资源管理员
**我想要** 在首页快速了解平台整体健康状况
**以便** 及时发现潜在问题

#### 2.1 验收标准

```gherkin
Feature: 查看平台健康总览

  Scenario: 首页展示关键指标
    Given 用户登录 JustFit
    When 用户进入首页
    Then 显示以下 KPI 卡片：
      | 指标 | 说明 |
      | 健康评分 | 平台整体健康分数 |
      | 僵尸 VM 数 | 检测到的僵尸虚拟机数量 |
      | 可节省资源 | 优化后可节省的资源估算 |
      | 异常任务数 | 失败或异常的任务数量 |

  Scenario: 显示平台连接状态
    Given 已配置平台连接
    When 用户进入首页
    Then 显示各平台连接状态卡片
    And 包含：平台类型、连接状态、最后采集时间
```

#### 2.2 验收测试清单

- [ ] KPI 指标正确计算并展示
- [ ] 平台连接状态实时更新
- [ ] 支持点击 KPI 卡片跳转详情页
- [ ] 支持刷新数据

---

### US-004: 识别僵尸虚拟机

**作为** 运维工程师
**我想要** 识别长期低负载的僵尸虚拟机
**以便** 回收闲置资源降低成本

#### 2.1 验收标准

```gherkin
Feature: 识别僵尸虚拟机

  Scenario: 查看僵尸 VM 列表
    Given 用户在"僵尸 VM"分析页面
    And 已完成数据采集与分析
    When 用户查看分析结果
    Then 显示被识别为僵尸的虚拟机列表
    And 每条记录包含：VM 名称、置信度、节省估算

  Scenario: 查看僵尸 VM 详情
    Given 用户在僵尸 VM 列表
    When 用户点击某个 VM
    Then 显示详情抽屉
    And 包含：
      | 内容 | 说明 |
      | 趋势图 | CPU/内存/IO 使用趋势 |
      | 统计卡 | 均值、P95、峰值 |
      | 证据说明 | 检测依据与阈值 |
      | 建议动作 | 关机/迁移/保留 |

  Scenario: 配置检测规则
    Given 用户在僵尸 VM 分析页面
    When 用户点击"规则配置"
    Then 显示规则配置对话框
    And 可配置：检测窗口、阈值指标
```

#### 2.2 验收测试清单

- [ ] 僵尸 VM 检测算法正确
- [ ] 列表按严重度/置信度排序
- [ ] 详情趋势图准确展示
- [ ] 统计数据正确计算
- [ ] 支持配置检测阈值
- [ ] 支持白名单功能

---

### US-005: 获取资源配置建议（Right Size）

**作为** 运维工程师
**我想要** 了解虚拟机的资源配置是否合理
**以便** 优化资源配置提高利用率

#### 2.1 验收标准

```gherkin
Feature: 资源配置评估

  Scenario: 查看评估结果列表
    Given 用户在"Right Size"分析页面
    And 已完成数据采集与分析
    When 用户查看分析结果
    Then 显示虚拟机资源配置评估列表
    And 每条记录包含：
      | VM 名称 | 当前配置 | 建议配置 | 风险等级 |

  Scenario: 查看评估详情
    Given 用户在评估结果列表
    When 用户点击某个 VM
    Then 显示详情抽屉
    And 包含：
      | 内容 | 说明 |
      | 使用率趋势 | CPU/内存使用率趋势图 |
      | 配置对比 | 当前 vs 建议配置 |
      | 节省估算 | 预计节省的资源 |
      | 风险提示 | 配置变更风险说明 |
      | 回滚建议 | 如需回滚的建议配置 |

  Scenario: 筛选优化建议
    Given 用户在评估结果列表
    When 用户选择筛选条件"建议扩容"
    Then 仅显示需要扩容的 VM
```

#### 2.2 验收测试清单

- [ ] Right Size 算法基于 P95 计算
- [ ] 建议配置合理可执行
- [ ] 节省估算准确
- [ ] 风险提示清晰
- [ ] 支持按优化类型筛选

---

### US-006: 识别潮汐性工作负载

**作为** 运维工程师
**我想要** 识别具有周期性特征的虚拟机负载
**以便** 制定启停策略进一步节省资源

#### 2.1 验收标准

```gherkin
Feature: 潮汐性负载检测

  Scenario: 查看潮汐检测结果
    Given 用户在"潮汐检测"分析页面
    And 已完成数据采集与分析
    When 用户查看分析结果
    Then 显示具有潮汐特征的虚拟机列表
    And 每条记录包含：
      | VM 名称 | 周期类型 | 峰谷差 | 建议启停时段 |

  Scenario: 查看潮汐详情
    Given 用户在潮汐检测结果列表
    When 用户点击某个 VM
    Then 显示详情抽屉
    And 包含：
      | 内容 | 说明 |
      | 周期图 | 按日/周聚合的负载曲线 |
      | 峰谷分析 | 峰值和谷值时段 |
      | 启停建议 | 建议关机和启动时间 |
      | 节省估算 | 启停策略可节省的资源 |
      | 稳定性评分 | 周期规律的稳定程度 |
```

#### 2.2 验收测试清单

- [ ] 日周期检测算法正确
- [ ] 周周期检测算法正确
- [ ] 峰谷时段识别准确
- [ ] 启停建议时间明确
- [ ] 稳定性评分合理

---

### US-007: 查看平台健康详情

**作为** 资源管理员
**我想要** 评估主机和集群的整体健康状况
**以便** 发现潜在的资源瓶颈和热点

#### 2.1 验收标准

```gherkin
Feature: 平台健康评估

  Scenario: 查看健康评分
    Given 用户在"平台健康"分析页面
    And 已完成数据采集与分析
    When 用户查看分析结果
    Then 显示主机/集群健康评分仪表
    And 评分维度包括：
      | 维度 | 说明 |
      | 资源均衡 | 各主机资源分配均衡度 |
      | 超配风险 | CPU/内存超分配风险 |
      | 热点集中 | 是否存在热点主机 |

  Scenario: 查看风险详情
    Given 用户在平台健康页面
    When 用户点击某个风险项
    Then 显示风险详情
    And 包含：影响范围、关联主机、改善建议

  Scenario: 识别热点主机
    Given 用户在平台健康页面
    When 用户查看热点列表
    Then 显示负载最高的主机
    And 标注热点指标
```

#### 2.2 验收测试清单

- [ ] 健康评分算法合理
- [ ] 各维度评分可解释
- [ ] 热点主机识别准确
- [ ] 风险建议具有可操作性

---

### US-008: 生成并导出分析报告

**作为** 管理者
**我想要** 生成包含所有分析结果的综合报告
**以便** 向上级汇报优化成果

#### 2.1 验收标准

```gherkin
Feature: 报告生成与导出

  Scenario: 生成分析报告
    Given 用户在"报告"页面
    And 已完成数据分析
    When 用户点击"生成报告"
    And 选择报告范围和类型
    Then 系统生成报告
    And 报告包含：
      | 内容 | 说明 |
      | 执行摘要 | 关键发现与建议 |
      | 数据概览 | 采集范围与统计 |
      | 分析结果 | 各分析类型的结果 |
      | 优化建议 | 可执行的优化清单 |
      | 图表 | 关键指标可视化 |

  Scenario: 导出报告
    Given 报告已生成
    When 用户点击"导出"
    And 选择导出格式（PDF/HTML/JSON）
    Then 报告被导出到指定位置
    And 导出进度显示

  Scenario: 查看历史报告
    Given 用户在"报告"页面
    When 用户查看报告列表
    Then 显示所有历史报告
    And 支持按时间、类型筛选
```

#### 2.2 验收测试清单

- [ ] 报告内容完整准确
- [ ] PDF 导出格式正确
- [ ] HTML 导出样式正常
- [ ] JSON 导出结构完整
- [ ] 报告生成性能满足要求

---

### US-009: 管理系统配置

**作为** 资源管理员
**我想要** 配置系统参数和数据保留策略
**以便** 系统按照预期运行

#### 2.1 验收标准

```gherkin
Feature: 系统配置管理

  Scenario: 配置数据保留策略
    Given 用户在"系统设置"页面
    When 用户配置数据保留天数
    And 用户点击"保存"
    Then 配置被保存
    And 过期数据按策略清理

  Scenario: 配置默认采集参数
    Given 用户在"系统设置"页面
    When 用户配置默认采样周期
    And 用户点击"保存"
    Then 新采集任务使用该默认值

  Scenario: 导出诊断日志
    Given 用户在"系统设置"页面
    When 用户点击"导出诊断包"
    Then 系统打包日志并下载
    And 包含：系统日志、任务日志、配置信息

  Scenario: 检查更新
    Given 用户在"系统设置"页面
    When 用户点击"检查更新"
    Then 系统检查是否有新版本
    And 有新版本时跳转发布页面
```

#### 2.2 验收测试清单

- [ ] 数据保留策略正确执行
- [ ] 默认参数配置生效
- [ ] 诊断包包含完整信息
- [ ] 更新检查功能正常

---

## 3. 非功能性用户故事

### US-NFR-001: 多平台兼容性

**作为** 用户
**我想要** 在不同操作系统上使用 JustFit
**以便** 在我的工作环境中正常运行

| 平台 | 支持状态 | 测试重点 |
|------|----------|----------|
| Windows 10/11 | 支持 | 安装、运行、UI 显示 |
| 麒麟 V10 | 支持 | 国产环境兼容性 |
| 统信 UOS | 支持 | 国产环境兼容性 |
| macOS x86/ARM | 支持 | Apple Silicon 适配 |

### US-NFR-002: 系统性能

**作为** 用户
**我想要** 系统响应快速且采集不阻塞界面
**以便** 高效完成工作

| 场景 | 性能要求 |
|------|----------|
| 页面切换 | < 500ms |
| 列表加载 | < 1s |
| 单 VM 分析 | < 2s |
| 整体报告生成 | < 30s |
| 后台采集 | 不阻塞 UI |

### US-NFR-003: 数据安全

**作为** 用户
**我想要** 我的连接凭据安全存储
**以便** 防止敏感信息泄露

- [ ] 凭据使用 AES-256 加密存储
- [ ] 日志不记录明文凭据
- [ ] 数据仅存储在本地

---

## 4. 验收测试计划

### 4.1 测试类型

| 测试类型 | 覆盖范围 | 执行时机 |
|----------|----------|----------|
| 单元测试 | 各模块函数 | 开发过程中 |
| 集成测试 | 模块间交互 | 开发完成后 |
| 系统测试 | 完整用户场景 | 提测阶段 |
| 验收测试 | 用户故事 | UAT 阶段 |
| 性能测试 | 性能需求 | 提测阶段 |
| 兼容性测试 | 多平台 | 发布前 |

### 4.2 用户故事验收矩阵

| 用户故事 | 功能验收 | 性能验收 | 安全验收 |
|----------|----------|----------|----------|
| US-001 | ✓ | ✓ | ✓ |
| US-002 | ✓ | ✓ | - |
| US-003 | ✓ | ✓ | - |
| US-004 | ✓ | ✓ | - |
| US-005 | ✓ | ✓ | - |
| US-006 | ✓ | ✓ | - |
| US-007 | ✓ | ✓ | - |
| US-008 | ✓ | ✓ | - |
| US-009 | ✓ | - | ✓ |

---

## 5. 变更记录

| 版本 | 日期 | 变更内容 | 作者 |
|------|------|----------|------|
| v1.0 | 2026-02-07 | 初始版本 | - |
