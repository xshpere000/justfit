# JustFit API 接口设计文档

## 0. 文档信息

| 项目 | 内容 |
|------|------|
| 文档名称 | API 接口设计文档 |
| 版本 | v1.0 |
| 日期 | 2026-02-07 |
| 项目版本 | v0.0.1 Beta |
| 通信方式 | Wails IPC (Go <-> JavaScript) |

## 1. API 设计原则

### 1.1 设计规范

| 原则 | 说明 |
|------|------|
| RESTful 风格 | 虽是 IPC 调用，接口设计遵循 RESTful 风格 |
| 错误处理 | 统一错误码和错误信息 |
| 数据验证 | 前后端都进行数据验证 |
| 幂等性 | 关键操作支持幂等调用 |
| 版本控制 | 预留版本扩展能力 |

### 1.2 统一响应结构

```go
// 通用响应结构
type Response struct {
    Code    int         `json:"code"`     // 状态码
    Message string      `json:"message"`  // 消息
    Data    interface{} `json:"data"`     // 数据
    TraceID string      `json:"trace_id"` // 追踪ID
}

// 分页响应
type PageResponse struct {
    Code      int         `json:"code"`
    Message   string      `json:"message"`
    Data      interface{} `json:"data"`
    TraceID   string      `json:"trace_id"`
    Page      int         `json:"page"`      // 当前页
    PageSize  int         `json:"page_size"` // 每页数量
    Total     int         `json:"total"`     // 总数
}

// 状态码定义
const (
    CodeSuccess      = 0     // 成功
    CodeError        = 500   // 通用错误
    CodeInvalidParam = 400   // 参数错误
    CodeNotFound     = 404   // 资源不存在
    CodeUnauthorized = 401   // 未授权
    CodeTimeout      = 408   // 超时
)
```

## 2. 连接管理 API

### 2.1 创建连接

```go
// CreateConnection 创建新的平台连接
type CreateConnectionRequest struct {
    Name     string `json:"name" binding:"required"`     // 连接名称
    Type     string `json:"type" binding:"required"`     // vcenter, h3c
    Endpoint string `json:"endpoint" binding:"required"` // 服务器地址
    Port     int    `json:"port"`                        // 端口，默认 443
    Username string `json:"username"`                    // 用户名
    Password string `json:"password"`                    // 密码（传输时加密）
    VerifyTLS bool  `json:"verify_tls"`                  // 是否验证证书
}

type CreateConnectionResponse struct {
    ID   string `json:"id"`   // 连接 ID
    Name string `json:"name"` // 连接名称
}
```

### 2.2 测试连接

```go
// TestConnection 测试连接是否可用
type TestConnectionRequest struct {
    ID       string `json:"id" binding:"required"`       // 连接 ID
    Endpoint string `json:"endpoint" binding:"required"` // 服务器地址
    Username string `json:"username"`                    // 用户名
    Password string `json:"password"`                    // 密码
}

type TestConnectionResponse struct {
    Success       bool   `json:"success"`        // 是否成功
    Message       string `json:"message"`        // 消息
    Latency       int64  `json:"latency"`        // 延迟（毫秒）
    ServerVersion string `json:"server_version"` // 服务器版本
}
```

### 2.3 获取连接列表

```go
// ListConnections 获取所有连接
type ListConnectionsRequest struct {
    Type   string `json:"type"`   // 按类型筛选
    Status string `json:"status"` // 按状态筛选
}

type ConnectionInfo struct {
    ID          string `json:"id"`
    Name        string `json:"name"`
    Type        string `json:"type"`
    Endpoint    string `json:"endpoint"`
    Status      string `json:"status"`       // connected, disconnected, error
    LastSyncAt  int64  `json:"last_sync_at"` // 最后同步时间
    ErrorMessage string `json:"error_message"`
    CreatedAt   int64  `json:"created_at"`
}

type ListConnectionsResponse struct {
    Connections []ConnectionInfo `json:"connections"`
}
```

### 2.4 获取连接详情

```go
// GetConnection 获取单个连接详情
type GetConnectionResponse struct {
    ID          string `json:"id"`
    Name        string `json:"name"`
    Type        string `json:"type"`
    Endpoint    string `json:"endpoint"`
    Port        int    `json:"port"`
    Username    string `json:"username"`
    Status      string `json:"status"`
    LastSyncAt  int64  `json:"last_sync_at"`
    ErrorMessage string `json:"error_message"`
    Metadata    string `json:"metadata"`    // JSON 格式扩展信息
    CreatedAt   int64  `json:"created_at"`
    UpdatedAt   int64  `json:"updated_at"`
}
```

### 2.5 更新连接

```go
// UpdateConnection 更新连接配置
type UpdateConnectionRequest struct {
    ID       string `json:"id" binding:"required"`
    Name     string `json:"name"`
    Endpoint string `json:"endpoint"`
    Port     int    `json:"port"`
    Username string `json:"username"`
    Password string `json:"password"` // 可选，不更新则留空
    VerifyTLS bool  `json:"verify_tls"`
}
```

### 2.6 删除连接

```go
// DeleteConnection 删除连接
type DeleteConnectionRequest struct {
    ID string `json:"id" binding:"required"`
}
```

## 3. 采集任务 API

### 3.1 创建采集任务

```go
// CreateCollectTask 创建数据采集任务
type CollectScope struct {
    ClusterIDs []string `json:"cluster_ids"` // 集群 ID 列表，空表示全部
    HostIDs    []string `json:"host_ids"`    // 主机 ID 列表
    VMIDs      []string `json:"vm_ids"`      // 虚拟机 ID 列表
}

type CreateCollectTaskRequest struct {
    ConnectionID   string       `json:"connection_id" binding:"required"`
    Name           string       `json:"name"`                       // 任务名称
    Scope          CollectScope `json:"scope"`                      // 采集范围
    StartTime      int64        `json:"start_time"`                 // 开始时间（Unix 时间戳）
    EndTime        int64        `json:"end_time"`                   // 结束时间
    SampleInterval int          `json:"sample_interval"`            // 采样间隔（秒）
    Metrics        []string     `json:"metrics"`                    // 采集指标列表
}

type CreateCollectTaskResponse struct {
    TaskID string `json:"task_id"` // 任务 ID
}
```

### 3.2 获取任务列表

```go
// ListTasks 获取任务列表
type ListTasksRequest struct {
    Type   string `json:"type"`   // collect, analyze, report
    Status string `json:"status"` // pending, running, success, failed
    Page   int    `json:"page"`   // 页码
    Limit  int    `json:"limit"`  // 每页数量
}

type TaskInfo struct {
    ID          string `json:"id"`
    Type        string `json:"type"`
    Name        string `json:"name"`
    Status      string `json:"status"`
    Progress    float64 `json:"progress"`     // 进度 0-100
    CurrentStep string  `json:"current_step"` // 当前步骤
    TotalSteps  int     `json:"total_steps"`  // 总步骤数
    StartedAt   int64   `json:"started_at"`
    EndedAt     int64   `json:"ended_at"`
    CreatedAt   int64   `json:"created_at"`
}

type ListTasksResponse struct {
    Tasks []TaskInfo `json:"tasks"`
    Total int        `json:"total"`
    Page  int        `json:"page"`
}
```

### 3.3 获取任务详情

```go
// GetTask 获取任务详情
type GetTaskResponse struct {
    ID          string `json:"id"`
    Type        string `json:"type"`
    Name        string `json:"name"`
    Status      string `json:"status"`
    Progress    float64 `json:"progress"`
    CurrentStep string  `json:"current_step"`
    TotalSteps  int     `json:"total_steps"`
    Config      string  `json:"config"`       // JSON 格式配置
    ErrorMsg    string  `json:"error_message"`
    StartedAt   int64   `json:"started_at"`
    EndedAt     int64   `json:"ended_at"`
    CreatedAt   int64   `json:"created_at"`
    UpdatedAt   int64   `json:"updated_at"`
}
```

### 3.4 停止任务

```go
// StopTask 停止运行中的任务
type StopTaskRequest struct {
    TaskID string `json:"task_id" binding:"required"`
}
```

### 3.5 重试任务

```go
// RetryTask 重试失败的任务
type RetryTaskRequest struct {
    TaskID string `json:"task_id" binding:"required"`
}
```

### 3.6 获取任务日志

```go
// GetTaskLogs 获取任务执行日志
type GetTaskLogsRequest struct {
    TaskID string `json:"task_id" binding:"required"`
    Level  string `json:"level"`  // debug, info, warn, error
    Limit  int    `json:"limit"`  // 返回数量
}

type TaskLogEntry struct {
    Level     string `json:"level"`
    Message   string `json:"message"`
    Timestamp int64  `json:"timestamp"`
    Metadata  string `json:"metadata"` // JSON 格式扩展数据
}

type GetTaskLogsResponse struct {
    Logs []TaskLogEntry `json:"logs"`
}
```

## 4. 资源查询 API

### 4.1 获取集群列表

```go
// ListClusters 获取集群列表
type ListClustersRequest struct {
    ConnectionID string `json:"connection_id"`
    Status       string `json:"status"` // active, inactive, error
}

type ClusterInfo struct {
    ID          string `json:"id"`
    Name        string `json:"name"`
    Vendor      string `json:"vendor"`
    Region      string `json:"region"`
    Datacenter  string `json:"datacenter"`
    TotalCPU    int    `json:"total_cpu"`
    TotalMem    int    `json:"total_mem"`
    TotalDisk   int    `json:"total_disk"`
    HealthScore float64 `json:"health_score"`
    Status      string `json:"status"`
    HostCount   int    `json:"host_count"`
    VMCount     int    `json:"vm_count"`
}

type ListClustersResponse struct {
    Clusters []ClusterInfo `json:"clusters"`
}
```

### 4.2 获取主机列表

```go
// ListHosts 获取主机列表
type ListHostsRequest struct {
    ClusterID   string `json:"cluster_id"`
    ConnectionID string `json:"connection_id"`
    Status      string `json:"status"`
    Page        int    `json:"page"`
    Limit       int    `json:"limit"`
}

type HostInfo struct {
    ID          string  `json:"id"`
    Name        string  `json:"name"`
    ClusterID   string  `json:"cluster_id"`
    ClusterName string  `json:"cluster_name"`
    IPAddress   string  `json:"ip_address"`
    CPUTotal    int     `json:"cpu_total"`
    MemTotal    int     `json:"mem_total"`
    DiskTotal   int     `json:"disk_total"`
    CPUUsed     float64 `json:"cpu_used"`
    MemUsed     float64 `json:"mem_used"`
    DiskUsed    float64 `json:"disk_used"`
    VMCount     int     `json:"vm_count"`
    HealthScore float64 `json:"health_score"`
    Status      string  `json:"status"`
}

type ListHostsResponse struct {
    Hosts []HostInfo `json:"hosts"`
    Total int        `json:"total"`
}
```

### 4.3 获取虚拟机列表

```go
// ListVMs 获取虚拟机列表
type ListVMsRequest struct {
    HostID      string `json:"host_id"`
    ClusterID   string `json:"cluster_id"`
    ConnectionID string `json:"connection_id"`
    PowerState  string `json:"power_state"` // poweredOn, poweredOff, suspended
    IsTemplate  *bool  `json:"is_template"`
    Search      string `json:"search"`      // 名称搜索
    Page        int    `json:"page"`
    Limit       int    `json:"limit"`
}

type VMInfo struct {
    ID              string `json:"id"`
    Name            string `json:"name"`
    HostID          string `json:"host_id"`
    HostName        string `json:"host_name"`
    ClusterID       string `json:"cluster_id"`
    ClusterName     string `json:"cluster_name"`
    VCPU            int    `json:"vcpu"`
    VMem            int    `json:"vmem"`
    VDisk           int    `json:"vdisk"`
    OSType          string `json:"os_type"`
    OSVersion       string `json:"os_version"`
    PowerState      string `json:"power_state"`
    IPAddress       string `json:"ip_address"`
    GuestToolsStatus string `json:"guest_tools_status"`
    IsTemplate      bool   `json:"is_template"`
    Annotations     string `json:"annotations"`
}

type ListVMsResponse struct {
    VMs   []VMInfo `json:"vms"`
    Total int      `json:"total"`
}
```

### 4.4 获取指标数据

```go
// GetMetrics 获取实体指标数据
type GetMetricsRequest struct {
    EntityType string `json:"entity_type" binding:"required"` // cluster, host, vm
    EntityID   string `json:"entity_id" binding:"required"`
    MetricNames []string `json:"metric_names"`                 // 指标名称列表
    StartTime  int64  `json:"start_time"`                     // 开始时间
    EndTime    int64  `json:"end_time"`                       // 结束时间
    Aggregation string `json:"aggregation"`                   // avg, max, min, p95
    Interval   int    `json:"interval"`                       // 聚合间隔（秒）
}

type MetricSeries struct {
    Name     string  `json:"name"`     // 指标名称
    Unit     string  `json:"unit"`     // 单位
    Datapoints []DataPoint `json:"datapoints"`
}

type DataPoint struct {
    Timestamp int64   `json:"timestamp"`
    Value     float64 `json:"value"`
}

type GetMetricsResponse struct {
    EntityType string       `json:"entity_type"`
    EntityID   string       `json:"entity_id"`
    Metrics    []MetricSeries `json:"metrics"`
}
```

### 4.5 获取实体详情

```go
// GetEntityDetail 获取实体详细信息（含汇总指标）
type GetEntityDetailRequest struct {
    EntityType string `json:"entity_type" binding:"required"`
    EntityID   string `json:"entity_id" binding:"required"`
}

type EntityDetailResponse struct {
    EntityType string                 `json:"entity_type"`
    EntityID   string                 `json:"entity_id"`
    Info       map[string]interface{} `json:"info"`       // 基本信息
    Metrics    map[string]MetricStats `json:"metrics"`    // 指标统计
    Alerts     []AlertInfo            `json:"alerts"`     // 关联告警
}

type MetricStats struct {
    Avg     float64 `json:"avg"`
    Max     float64 `json:"max"`
    Min     float64 `json:"min"`
    P95     float64 `json:"p95"`
    Current float64 `json:"current"`
    Unit    string  `json:"unit"`
}
```

## 5. 分析 API

### 5.1 执行分析

```go
// RunAnalysis 执行资源分析
type AnalysisRequest struct {
    Type       string `json:"type" binding:"required"` // zombie, rightsize, tidal, health
    EntityType string `json:"entity_type"`             // cluster, host, vm
    EntityIDs  []string `json:"entity_ids"`            // 实体 ID 列表，空表示全部
    Options    string `json:"options"`                 // JSON 格式分析选项
}

type AnalysisResponse struct {
    AnalysisID string `json:"analysis_id"` // 分析 ID
    Status     string `json:"status"`      // running, completed, failed
}
```

### 5.2 获取分析结果

```go
// GetAnalysisResult 获取分析结果
type GetAnalysisResultRequest struct {
    AnalysisID string `json:"analysis_id" binding:"required"`
}

type AnalysisResult struct {
    ID          string            `json:"id"`
    Type        string            `json:"type"`
    Status      string            `json:"status"`
    Summary     string            `json:"summary"`     // 摘要
    Results     []AnalysisEntry   `json:"results"`     // 结果列表
    Statistics  map[string]int    `json:"statistics"`  // 统计信息
    CreatedAt   int64             `json:"created_at"`
}

type AnalysisEntry struct {
    EntityType  string  `json:"entity_type"`
    EntityID    string  `json:"entity_id"`
    EntityName  string  `json:"entity_name"`
    Conclusion  string  `json:"conclusion"`   // 结论
    Confidence  float64 `json:"confidence"`   // 置信度
    Recommendation string `json:"recommendation"` // 建议
    Evidence    string  `json:"evidence"`     // JSON 格式证据数据
    Savings     string  `json:"savings"`      // JSON 格式节省估算
    RiskLevel   string  `json:"risk_level"`   // low, medium, high
}

// 僵尸 VM 专用结构
type ZombieEvidence struct {
    DurationDays int     `json:"duration_days"`
    CPUMean      float64 `json:"cpu_mean"`
    CPUP95       float64 `json:"cpu_p95"`
    MemMean      float64 `json:"mem_mean"`
    MemP95       float64 `json:"mem_p95"`
    IOMean       float64 `json:"io_mean"`
}

// Right Size 专用结构
type RightSizeEvidence struct {
    CurrentConfig ResourceConfig `json:"current_config"`
    Recommended  ResourceConfig `json:"recommended"`
    Utilization  UtilizationData `json:"utilization"`
}

type ResourceConfig struct {
    VCPU int `json:"vcpu"`
    Mem  int `json:"mem"`  // MB
}

type UtilizationData struct {
    CPUP95  float64 `json:"cpu_p95"`
    MemP95  float64 `json:"mem_p95"`
}

// 潮汐检测专用结构
type TidalEvidence struct {
    CycleType   string  `json:"cycle_type"`   // daily, weekly
    Stability   float64 `json:"stability"`    // 稳定性评分
    PeakHours   []int   `json:"peak_hours"`   // 峰值时段
    OffPeakHours []int  `json:"off_peak_hours"` // 谷值时段
    PeakDiff    float64 `json:"peak_diff"`    // 峰谷差
}

// 健康评分专用结构
type HealthEvidence struct {
    Score       float64 `json:"score"`
    BalanceScore float64 `json:"balance_score"`   // 均衡度
    OvercommitRisk float64 `json:"overcommit_risk"` // 超配风险
    Hotspots    []string `json:"hotspots"`        // 热点主机列表
}
```

### 5.3 获取分析汇总

```go
// GetAnalysisSummary 获取分析结果汇总
type GetAnalysisSummaryRequest struct {
    Type       string `json:"type"`
    EntityType string `json:"entity_type"`
    EntityID   string `json:"entity_id"`
}

type AnalysisSummary struct {
    Type           string  `json:"type"`
    TotalCount     int     `json:"total_count"`
    HighRiskCount  int     `json:"high_risk_count"`
    MediumRiskCount int    `json:"medium_risk_count"`
    LowRiskCount   int     `json:"low_risk_count"`
    TotalSavings   SavingsEstimate `json:"total_savings"`
    LastAnalyzedAt int64  `json:"last_analyzed_at"`
}

type SavingsEstimate struct {
    CPU      int     `json:"cpu"`       // 可节省 CPU 核数
    Mem      int     `json:"mem"`       // 可节省内存 (MB)
    Disk     int     `json:"disk"`      // 可节省磁盘 (GB)
    Estimated float64 `json:"estimated"` // 估算金额（可选）
}
```

## 6. 报告 API

### 6.1 生成报告

```go
// GenerateReport 生成分析报告
type GenerateReportRequest struct {
    Name       string   `json:"name" binding:"required"`
    Type       string   `json:"type"` // zombie, rightsize, tidal, health, summary
    AnalysisID string   `json:"analysis_id"` // 关联分析 ID
    EntityType string   `json:"entity_type"`
    EntityIDs  []string `json:"entity_ids"`
    Format     string   `json:"format"` // json, html, pdf
    Options    string   `json:"options"` // JSON 格式报告选项
}

type GenerateReportResponse struct {
    ReportID string `json:"report_id"`
    Status   string `json:"status"` // generating, completed, failed
}
```

### 6.2 获取报告列表

```go
// ListReports 获取报告列表
type ListReportsRequest struct {
    Type       string `json:"type"`
    EntityType string `json:"entity_type"`
    Status     string `json:"status"`
    StartTime  int64  `json:"start_time"`
    EndTime    int64  `json:"end_time"`
    Page       int    `json:"page"`
    Limit      int    `json:"limit"`
}

type ReportInfo struct {
    ID          string `json:"id"`
    Name        string `json:"name"`
    Type        string `json:"type"`
    EntityType  string `json:"entity_type"`
    EntityID    string `json:"entity_id"`
    Format      string `json:"format"`
    Status      string `json:"status"`
    Summary     string `json:"summary"`
    CreatedAt   int64  `json:"created_at"`
}

type ListReportsResponse struct {
    Reports []ReportInfo `json:"reports"`
    Total   int          `json:"total"`
}
```

### 6.3 获取报告详情

```go
// GetReport 获取报告详情
type GetReportResponse struct {
    ID          string                 `json:"id"`
    Name        string                 `json:"name"`
    Type        string                 `json:"type"`
    EntityType  string                 `json:"entity_type"`
    EntityID    string                 `json:"entity_id"`
    Summary     string                 `json:"summary"`
    Detail      map[string]interface{} `json:"detail"`
    Format      string                 `json:"format"`
    FilePath    string                 `json:"file_path"`
    Status      string                 `json:"status"`
    CreatedAt   int64                  `json:"created_at"`
}
```

### 6.4 导出报告

```go
// ExportReport 导出报告文件
type ExportReportRequest struct {
    ReportID string `json:"report_id" binding:"required"`
    Format   string `json:"format"` // json, html, pdf
    FilePath string `json:"file_path"` // 导出路径，空则默认位置
}

type ExportReportResponse struct {
    FilePath string `json:"file_path"` // 实际导出路径
    Size     int64  `json:"size"`     // 文件大小
}
```

## 7. 系统配置 API

### 7.1 获取配置

```go
// GetSettings 获取系统配置
type GetSettingsRequest struct {
    Keys []string `json:"keys"` // 指定要获取的配置项，空则全部
}

type SettingItem struct {
    Key         string `json:"key"`
    Value       string `json:"value"`
    Type        string `json:"type"`
    Description string `json:"description"`
}

type GetSettingsResponse struct {
    Settings []SettingItem `json:"settings"`
}
```

### 7.2 更新配置

```go
// UpdateSettings 更新系统配置
type UpdateSettingsRequest struct {
    Settings []SettingItem `json:"settings"`
}
```

### 7.3 导出诊断包

```go
// ExportDiagnosticPackage 导出诊断包
type ExportDiagnosticPackageRequest struct {
    IncludeLogs    bool `json:"include_logs"`    // 包含日志
    IncludeConfig  bool `json:"include_config"`  // 包含配置
    IncludeMetrics bool `json:"include_metrics"` // 包含指标数据
}

type ExportDiagnosticPackageResponse struct {
    FilePath string `json:"file_path"` // 压缩包路径
    Size     int64  `json:"size"`
}
```

### 7.4 检查更新

```go
// CheckUpdate 检查应用更新
type CheckUpdateResponse struct {
    HasUpdate  bool   `json:"has_update"`
    CurrentVer string `json:"current_version"`
    LatestVer  string `json:"latest_version"`
    ReleaseURL string `json:"release_url"` // 发布页 URL
}
```

## 8. 告警 API

### 8.1 获取告警列表

```go
// ListAlerts 获取告警列表
type ListAlertsRequest struct {
    EntityType  string `json:"entity_type"`
    EntityID    string `json:"entity_id"`
    AlertType   string `json:"alert_type"`
    Severity    string `json:"severity"`   // info, warning, critical
    IsResolved  *bool  `json:"is_resolved"`
    IsRead      *bool  `json:"is_read"`
    StartTime   int64  `json:"start_time"`
    EndTime     int64  `json:"end_time"`
    Page        int    `json:"page"`
    Limit       int    `json:"limit"`
}

type AlertInfo struct {
    ID          string `json:"id"`
    EntityType  string `json:"entity_type"`
    EntityID    string `json:"entity_id"`
    EntityName  string `json:"entity_name"`
    AlertType   string `json:"alert_type"`
    Severity    string `json:"severity"`
    Title       string `json:"title"`
    Message     string `json:"message"`
    IsResolved  bool   `json:"is_resolved"`
    IsRead      bool   `json:"is_read"`
    CreatedAt   int64  `json:"created_at"`
}

type ListAlertsResponse struct {
    Alerts      []AlertInfo `json:"alerts"`
    UnreadCount int         `json:"unread_count"`
    Total       int         `json:"total"`
}
```

### 8.2 标记告警

```go
// MarkAlert 标记告警状态
type MarkAlertRequest struct {
    AlertIDs   []string `json:"alert_ids" binding:"required"`
    IsRead     *bool    `json:"is_read"`     // 标记已读/未读
    IsResolved *bool    `json:"is_resolved"` // 标记已解决/未解决
}
```

## 9. WebSocket 事件

### 9.1 任务进度推送

```javascript
// 前端订阅任务进度
{
  "event": "task.progress",
  "data": {
    "task_id": "xxx",
    "status": "running",
    "progress": 45.5,
    "current_step": "采集指标数据",
    "total_steps": 10
  }
}
```

### 9.2 任务完成推送

```javascript
{
  "event": "task.completed",
  "data": {
    "task_id": "xxx",
    "type": "collect",
    "status": "success",
    "ended_at": 1234567890
  }
}
```

### 9.3 告警推送

```javascript
{
  "event": "alert.created",
  "data": {
    "id": "xxx",
    "entity_type": "vm",
    "entity_id": "vm-123",
    "alert_type": "zombie",
    "severity": "warning",
    "title": "发现僵尸虚拟机",
    "message": "虚拟机 xxx 连续 14 天低负载"
  }
}
```

## 10. 错误码定义

| 错误码 | 说明 |
|--------|------|
| 0 | 成功 |
| 400 | 参数错误 |
| 401 | 未授权 |
| 404 | 资源不存在 |
| 408 | 请求超时 |
| 409 | 资源冲突 |
| 500 | 服务器内部错误 |
| 1001 | 连接失败 |
| 1002 | 采集失败 |
| 1003 | 分析失败 |
| 1004 | 报告生成失败 |
| 1005 | 配置错误 |

## 11. 前端 API 调用示例

```typescript
// api/connection.ts
import { EventsOn, EventsOff } from '../../wailsjs/runtime/runtime';

export interface ConnectionService {
  CreateConnection(req: CreateConnectionRequest): Promise<Response>;
  ListConnections(req: ListConnectionsRequest): Promise<ListConnectionsResponse>;
  TestConnection(req: TestConnectionRequest): Promise<TestConnectionResponse>;
  DeleteConnection(req: DeleteConnectionRequest): Promise<Response>;
}

// 使用示例
export async function createConnection(data: CreateConnectionRequest) {
  try {
    const res = await ConnectionService.CreateConnection(data);
    if (res.code !== 0) {
      throw new Error(res.message);
    }
    return res.data;
  } catch (error) {
    console.error('创建连接失败:', error);
    throw error;
  }
}

// 订阅任务进度
export function subscribeTaskProgress(
  taskId: string,
  callback: (data: TaskProgressData) => void
) {
  const handler = (data: any) => {
    if (data.task_id === taskId) {
      callback(data);
    }
  };
  EventsOn('task.progress', handler);
  return () => EventsOff('task.progress', handler);
}
```

## 12. 变更记录

| 版本 | 日期 | 变更内容 | 作者 |
|------|------|----------|------|
| v1.0 | 2026-02-07 | 初始版本 | - |
